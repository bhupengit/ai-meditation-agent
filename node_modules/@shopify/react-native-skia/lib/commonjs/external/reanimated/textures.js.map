{"version":3,"names":["_react","require","_Offscreen","_skia","_Platform","_ReanimatedProxy","_interopRequireDefault","e","__esModule","default","createTextureFromImage","texture","image","surface","Skia","Surface","MakeOffscreen","width","height","value","canvas","getCanvas","drawImage","flush","makeImageSnapshot","Platform","OS","makeNonTextureImage","createTexture","picture","size","drawPicture","useTexture","element","deps","setPicture","useState","useEffect","drawAsPicture","x","y","then","pic","usePictureAsTexture","exports","Rea","useSharedValue","runOnUI","useImageAsTexture","source","useImage"],"sources":["textures.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport type { DependencyList, ReactElement } from \"react\";\nimport type { SharedValue } from \"react-native-reanimated\";\n\nimport type {\n  DataSourceParam,\n  SkImage,\n  SkPicture,\n  SkSize,\n} from \"../../skia/types\";\nimport { drawAsPicture } from \"../../renderer/Offscreen\";\nimport { Skia, useImage } from \"../../skia\";\nimport { Platform } from \"../../Platform\";\n\nimport Rea from \"./ReanimatedProxy\";\n\nconst createTextureFromImage = (\n  texture: SharedValue<SkImage | null>,\n  image: SkImage\n) => {\n  \"worklet\";\n  const surface = Skia.Surface.MakeOffscreen(image.width(), image.height());\n  if (!surface) {\n    texture.value = null;\n    return;\n  }\n  const canvas = surface.getCanvas();\n  canvas.drawImage(image, 0, 0);\n  surface.flush();\n  texture.value = surface.makeImageSnapshot();\n  if (Platform.OS === \"web\") {\n    texture.value = texture.value.makeNonTextureImage();\n  }\n};\n\nconst createTexture = (\n  texture: SharedValue<SkImage | null>,\n  picture: SkPicture,\n  size: SkSize\n) => {\n  \"worklet\";\n  const surface = Skia.Surface.MakeOffscreen(size.width, size.height)!;\n  const canvas = surface.getCanvas();\n  canvas.drawPicture(picture);\n  surface.flush();\n  texture.value = surface.makeImageSnapshot();\n  if (Platform.OS === \"web\") {\n    texture.value = texture.value.makeNonTextureImage();\n  }\n};\n\nexport const useTexture = (\n  element: ReactElement,\n  size: SkSize,\n  deps?: DependencyList\n) => {\n  const { width, height } = size;\n  const [picture, setPicture] = useState<SkPicture | null>(null);\n  useEffect(() => {\n    drawAsPicture(element, {\n      x: 0,\n      y: 0,\n      width,\n      height,\n    }).then((pic) => {\n      setPicture(pic);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps ?? []);\n  return usePictureAsTexture(picture, size);\n};\n\nexport const usePictureAsTexture = (\n  picture: SkPicture | null,\n  size: SkSize\n) => {\n  const texture = Rea.useSharedValue<SkImage | null>(null);\n  useEffect(() => {\n    if (picture !== null) {\n      Rea.runOnUI(createTexture)(texture, picture, size);\n    }\n  }, [picture, size, texture]);\n  return texture;\n};\n\nexport const useImageAsTexture = (source: DataSourceParam) => {\n  const image = useImage(source);\n  const texture = Rea.useSharedValue<SkImage | null>(null);\n  useEffect(() => {\n    if (image !== null) {\n      Rea.runOnUI(createTextureFromImage)(texture, image);\n    }\n  }, [image, texture]);\n  return texture;\n};\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAUA,IAAAC,UAAA,GAAAD,OAAA;AACA,IAAAE,KAAA,GAAAF,OAAA;AACA,IAAAG,SAAA,GAAAH,OAAA;AAEA,IAAAI,gBAAA,GAAAC,sBAAA,CAAAL,OAAA;AAAoC,SAAAK,uBAAAC,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEpC,MAAMG,sBAAsB,GAAGA,CAC7BC,OAAoC,EACpCC,KAAc,KACX;EACH,SAAS;;EACT,MAAMC,OAAO,GAAGC,UAAI,CAACC,OAAO,CAACC,aAAa,CAACJ,KAAK,CAACK,KAAK,CAAC,CAAC,EAAEL,KAAK,CAACM,MAAM,CAAC,CAAC,CAAC;EACzE,IAAI,CAACL,OAAO,EAAE;IACZF,OAAO,CAACQ,KAAK,GAAG,IAAI;IACpB;EACF;EACA,MAAMC,MAAM,GAAGP,OAAO,CAACQ,SAAS,CAAC,CAAC;EAClCD,MAAM,CAACE,SAAS,CAACV,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;EAC7BC,OAAO,CAACU,KAAK,CAAC,CAAC;EACfZ,OAAO,CAACQ,KAAK,GAAGN,OAAO,CAACW,iBAAiB,CAAC,CAAC;EAC3C,IAAIC,kBAAQ,CAACC,EAAE,KAAK,KAAK,EAAE;IACzBf,OAAO,CAACQ,KAAK,GAAGR,OAAO,CAACQ,KAAK,CAACQ,mBAAmB,CAAC,CAAC;EACrD;AACF,CAAC;AAED,MAAMC,aAAa,GAAGA,CACpBjB,OAAoC,EACpCkB,OAAkB,EAClBC,IAAY,KACT;EACH,SAAS;;EACT,MAAMjB,OAAO,GAAGC,UAAI,CAACC,OAAO,CAACC,aAAa,CAACc,IAAI,CAACb,KAAK,EAAEa,IAAI,CAACZ,MAAM,CAAE;EACpE,MAAME,MAAM,GAAGP,OAAO,CAACQ,SAAS,CAAC,CAAC;EAClCD,MAAM,CAACW,WAAW,CAACF,OAAO,CAAC;EAC3BhB,OAAO,CAACU,KAAK,CAAC,CAAC;EACfZ,OAAO,CAACQ,KAAK,GAAGN,OAAO,CAACW,iBAAiB,CAAC,CAAC;EAC3C,IAAIC,kBAAQ,CAACC,EAAE,KAAK,KAAK,EAAE;IACzBf,OAAO,CAACQ,KAAK,GAAGR,OAAO,CAACQ,KAAK,CAACQ,mBAAmB,CAAC,CAAC;EACrD;AACF,CAAC;AAEM,MAAMK,UAAU,GAAGA,CACxBC,OAAqB,EACrBH,IAAY,EACZI,IAAqB,KAClB;EACH,MAAM;IAAEjB,KAAK;IAAEC;EAAO,CAAC,GAAGY,IAAI;EAC9B,MAAM,CAACD,OAAO,EAAEM,UAAU,CAAC,GAAG,IAAAC,eAAQ,EAAmB,IAAI,CAAC;EAC9D,IAAAC,gBAAS,EAAC,MAAM;IACd,IAAAC,wBAAa,EAACL,OAAO,EAAE;MACrBM,CAAC,EAAE,CAAC;MACJC,CAAC,EAAE,CAAC;MACJvB,KAAK;MACLC;IACF,CAAC,CAAC,CAACuB,IAAI,CAAEC,GAAG,IAAK;MACfP,UAAU,CAACO,GAAG,CAAC;IACjB,CAAC,CAAC;IACF;EACF,CAAC,EAAER,IAAI,aAAJA,IAAI,cAAJA,IAAI,GAAI,EAAE,CAAC;EACd,OAAOS,mBAAmB,CAACd,OAAO,EAAEC,IAAI,CAAC;AAC3C,CAAC;AAACc,OAAA,CAAAZ,UAAA,GAAAA,UAAA;AAEK,MAAMW,mBAAmB,GAAGA,CACjCd,OAAyB,EACzBC,IAAY,KACT;EACH,MAAMnB,OAAO,GAAGkC,wBAAG,CAACC,cAAc,CAAiB,IAAI,CAAC;EACxD,IAAAT,gBAAS,EAAC,MAAM;IACd,IAAIR,OAAO,KAAK,IAAI,EAAE;MACpBgB,wBAAG,CAACE,OAAO,CAACnB,aAAa,CAAC,CAACjB,OAAO,EAAEkB,OAAO,EAAEC,IAAI,CAAC;IACpD;EACF,CAAC,EAAE,CAACD,OAAO,EAAEC,IAAI,EAAEnB,OAAO,CAAC,CAAC;EAC5B,OAAOA,OAAO;AAChB,CAAC;AAACiC,OAAA,CAAAD,mBAAA,GAAAA,mBAAA;AAEK,MAAMK,iBAAiB,GAAIC,MAAuB,IAAK;EAC5D,MAAMrC,KAAK,GAAG,IAAAsC,cAAQ,EAACD,MAAM,CAAC;EAC9B,MAAMtC,OAAO,GAAGkC,wBAAG,CAACC,cAAc,CAAiB,IAAI,CAAC;EACxD,IAAAT,gBAAS,EAAC,MAAM;IACd,IAAIzB,KAAK,KAAK,IAAI,EAAE;MAClBiC,wBAAG,CAACE,OAAO,CAACrC,sBAAsB,CAAC,CAACC,OAAO,EAAEC,KAAK,CAAC;IACrD;EACF,CAAC,EAAE,CAACA,KAAK,EAAED,OAAO,CAAC,CAAC;EACpB,OAAOA,OAAO;AAChB,CAAC;AAACiC,OAAA,CAAAI,iBAAA,GAAAA,iBAAA","ignoreList":[]}