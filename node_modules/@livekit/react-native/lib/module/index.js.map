{"version":3,"names":["registerGlobals","webrtcRegisterGlobals","setupURLPolyfill","AudioSession","AndroidAudioTypePresets","getDefaultAppleAudioConfigurationForMode","PixelRatio","Platform","RNE2EEManager","RNKeyProvider","setupNativeEvents","ReadableStream","WritableStream","options","opts","autoConfigureAudioSession","iosCategoryEnforce","livekitRegisterGlobals","fixWebrtcAdapter","shimPromiseAllSettled","shimArrayAt","shimCryptoUuid","shimWebstreams","OS","getUserMediaFunc","global","navigator","mediaDevices","getUserMedia","constraints","audio","setAppleAudioConfiguration","audioCategory","lkGlobal","platform","devicePixelRatio","get","LiveKitReactNativeGlobal","_window","window","undefined","userAgent","product","allSettled","require","shim","Array","prototype","at","_global$crypto","crypto","randomUUID","createRandomUUID","replace","c","r","Math","random","v","toString"],"sources":["index.tsx"],"sourcesContent":["import 'well-known-symbols/Symbol.asyncIterator/auto';\nimport 'well-known-symbols/Symbol.iterator/auto';\nimport './polyfills/MediaRecorderShim';\nimport { registerGlobals as webrtcRegisterGlobals } from '@livekit/react-native-webrtc';\nimport { setupURLPolyfill } from 'react-native-url-polyfill';\nimport './polyfills/EncoderDecoderTogether.min.js';\nimport AudioSession, {\n  AndroidAudioTypePresets,\n  type AndroidAudioTypeOptions,\n  type AppleAudioCategory,\n  type AppleAudioCategoryOption,\n  type AppleAudioConfiguration,\n  type AppleAudioMode,\n  type AudioTrackState,\n  getDefaultAppleAudioConfigurationForMode,\n} from './audio/AudioSession';\nimport type { AudioConfiguration } from './audio/AudioSession';\nimport { PixelRatio, Platform } from 'react-native';\nimport { type LiveKitReactNativeInfo } from 'livekit-client';\nimport type { LogLevel, SetLogLevelOptions } from './logger';\nimport RNE2EEManager from './e2ee/RNE2EEManager';\nimport RNKeyProvider, { type RNKeyProviderOptions } from './e2ee/RNKeyProvider';\nimport { setupNativeEvents } from './events/EventEmitter';\nimport { ReadableStream, WritableStream } from 'web-streams-polyfill';\n\nexport interface RegisterGlobalsOptions {\n  /**\n   * Automatically configure audio session before accessing microphone.\n   * When enabled, sets the iOS audio category to 'playAndRecord' before getUserMedia.\n   *\n   * @default true\n   * @platform ios\n   */\n  autoConfigureAudioSession?: boolean;\n}\n\n/**\n * Registers the required globals needed for LiveKit to work.\n *\n * Must be called before using LiveKit.\n *\n * @param options Optional configuration for global registration\n */\nexport function registerGlobals(options?: RegisterGlobalsOptions) {\n  const opts = {\n    autoConfigureAudioSession: true,\n    ...options,\n  };\n\n  webrtcRegisterGlobals();\n  if (opts.autoConfigureAudioSession) {\n    iosCategoryEnforce();\n  }\n  livekitRegisterGlobals();\n  setupURLPolyfill();\n  fixWebrtcAdapter();\n  shimPromiseAllSettled();\n  shimArrayAt();\n  shimCryptoUuid();\n  shimWebstreams();\n  setupNativeEvents();\n}\n\n/**\n * Enforces changing to playAndRecord category prior to obtaining microphone.\n */\nfunction iosCategoryEnforce() {\n  if (Platform.OS === 'ios') {\n    // @ts-ignore\n    let getUserMediaFunc = global.navigator.mediaDevices.getUserMedia;\n    // @ts-ignore\n    global.navigator.mediaDevices.getUserMedia = async (constraints: any) => {\n      if (constraints.audio) {\n        await AudioSession.setAppleAudioConfiguration({\n          audioCategory: 'playAndRecord',\n        });\n      }\n\n      return await getUserMediaFunc(constraints);\n    };\n  }\n}\n\nfunction livekitRegisterGlobals() {\n  let lkGlobal: LiveKitReactNativeInfo = {\n    platform: Platform.OS,\n    devicePixelRatio: PixelRatio.get(),\n  };\n\n  // @ts-ignore\n  global.LiveKitReactNativeGlobal = lkGlobal;\n}\n\nfunction fixWebrtcAdapter() {\n  // @ts-ignore\n  if (window?.navigator !== undefined) {\n    // @ts-ignore\n    const { navigator } = window;\n    if (navigator.userAgent === undefined) {\n      navigator.userAgent = navigator.product ?? 'Unknown';\n    }\n  }\n}\n\nfunction shimPromiseAllSettled() {\n  var allSettled = require('promise.allsettled');\n  allSettled.shim();\n}\n\nfunction shimArrayAt() {\n  // Some versions of RN don't have Array.prototype.at, which is used by sdp-transform\n  if (!Array.prototype.at) {\n    var at = require('array.prototype.at');\n    at.shim();\n  }\n}\n\nfunction shimCryptoUuid() {\n  let crypto = global.crypto;\n  if (typeof global.crypto?.randomUUID !== 'function') {\n    let createRandomUUID = () => {\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(\n        /[xy]/g,\n        function (c) {\n          /* eslint-disable no-bitwise */\n          const r = (Math.random() * 16) | 0;\n          const v = c === 'x' ? r : (r & 0x3) | 0x8;\n          return v.toString(16);\n        }\n      ) as `${string}-${string}-${string}-${string}-${string}`;\n    };\n\n    if (!crypto) {\n      crypto = {} as typeof global.crypto;\n      global.crypto = crypto;\n    }\n    crypto.randomUUID = createRandomUUID;\n  }\n}\n\nfunction shimWebstreams() {\n  // @ts-expect-error: global.WritableStream isn't typed here.\n  if (typeof global.WritableStream === 'undefined') {\n    // @ts-expect-error\n    global.WritableStream = WritableStream;\n  }\n\n  // @ts-expect-error: global.ReadableStream isn't typed here.\n  if (typeof global.ReadableStream === 'undefined') {\n    // @ts-expect-error\n    global.ReadableStream = ReadableStream;\n  }\n}\n\nexport * from './hooks';\nexport * from './components/BarVisualizer';\nexport * from './components/LiveKitRoom';\nexport * from './components/VideoTrack';\nexport * from './components/VideoView'; // deprecated\nexport * from './useParticipant'; // deprecated\nexport * from './useRoom'; // deprecated\nexport * from './logger';\nexport * from './audio/AudioManager';\n\nexport {\n  AudioSession,\n  RNE2EEManager,\n  RNKeyProvider,\n  AndroidAudioTypePresets,\n  getDefaultAppleAudioConfigurationForMode,\n};\nexport type {\n  AudioConfiguration,\n  AndroidAudioTypeOptions,\n  AppleAudioCategory,\n  AppleAudioCategoryOption,\n  AppleAudioConfiguration,\n  AppleAudioMode,\n  AudioTrackState,\n  LogLevel,\n  SetLogLevelOptions,\n  RNKeyProviderOptions,\n};\n"],"mappings":"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","ignoreList":[]}