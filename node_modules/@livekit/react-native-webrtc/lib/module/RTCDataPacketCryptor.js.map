{"version":3,"names":["base64","NativeModules","Logger","WebRTCModule","log","RTCDataPacketCryptor","constructor","dataPacketCryptorId","_defineProperty","_id","encrypt","participantId","keyIndex","data","params","fromByteArray","result","dataPacketCryptorEncrypt","info","payload","undefined","iv","toByteArray","decrypt","packet","dataPacketCryptorDecrypt","dispose","dataPacketCryptorDispose"],"sources":["RTCDataPacketCryptor.ts"],"sourcesContent":["import * as base64 from 'base64-js';\nimport { NativeModules } from 'react-native';\n\nimport Logger from './Logger';\nconst { WebRTCModule } = NativeModules;\nconst log = new Logger('pc');\n\nexport interface RTCEncryptedPacket {\n  payload: Uint8Array,\n  iv: Uint8Array,\n  keyIndex: number,\n}\n\nexport default class RTCDataPacketCryptor {\n    _id: string;\n\n    constructor(dataPacketCryptorId: string) {\n        this._id = dataPacketCryptorId;\n    }\n\n    async encrypt(participantId: string, keyIndex: number, data: Uint8Array): Promise<RTCEncryptedPacket | null> {\n        const params = {\n            dataPacketCryptorId: this._id,\n            participantId,\n            keyIndex,\n            data: base64.fromByteArray(data)\n        };\n\n        const result = await WebRTCModule.dataPacketCryptorEncrypt(params);\n\n        if (!result) {\n            log.info('encrypt: result null');\n\n            return null;\n        }\n\n        if (result.payload === undefined) {\n            log.info('encrypt: payload null');\n\n            return null;\n        }\n\n        if (result.iv === undefined) {\n            log.info('encrypt: iv null');\n\n            return null;\n        }\n\n        if (result.keyIndex === undefined) {\n            log.info('encrypt: keyIndex null');\n\n            return null;\n        }\n\n        return {\n            payload: base64.toByteArray(result.payload),\n            iv: base64.toByteArray(result.iv),\n            keyIndex: result.keyIndex\n        };\n    }\n\n    async decrypt(participantId: string, packet: RTCEncryptedPacket): Promise<Uint8Array | null> {\n        const params = {\n            dataPacketCryptorId: this._id,\n            participantId,\n            payload: base64.fromByteArray(packet.payload),\n            iv: base64.fromByteArray(packet.iv),\n            keyIndex: packet.keyIndex,\n        };\n\n        const result = await WebRTCModule.dataPacketCryptorDecrypt(params);\n\n        if (!result) {\n            log.info('decrypt: result null');\n\n            return null;\n        }\n\n        return base64.toByteArray(result.data);\n    }\n\n\n    async dispose() {\n        const params = {\n            dataPacketCryptorId: this._id,\n        };\n\n        await WebRTCModule.dataPacketCryptorDispose(params);\n    }\n}\n"],"mappings":";AAAA,OAAO,KAAKA,MAAM,MAAM,WAAW;AACnC,SAASC,aAAa,QAAQ,cAAc;AAE5C,OAAOC,MAAM,MAAM,UAAU;AAC7B,MAAM;EAAEC;AAAa,CAAC,GAAGF,aAAa;AACtC,MAAMG,GAAG,GAAG,IAAIF,MAAM,CAAC,IAAI,CAAC;AAQ5B,eAAe,MAAMG,oBAAoB,CAAC;EAGtCC,WAAWA,CAACC,mBAA2B,EAAE;IAAAC,eAAA;IACrC,IAAI,CAACC,GAAG,GAAGF,mBAAmB;EAClC;EAEA,MAAMG,OAAOA,CAACC,aAAqB,EAAEC,QAAgB,EAAEC,IAAgB,EAAsC;IACzG,MAAMC,MAAM,GAAG;MACXP,mBAAmB,EAAE,IAAI,CAACE,GAAG;MAC7BE,aAAa;MACbC,QAAQ;MACRC,IAAI,EAAEb,MAAM,CAACe,aAAa,CAACF,IAAI;IACnC,CAAC;IAED,MAAMG,MAAM,GAAG,MAAMb,YAAY,CAACc,wBAAwB,CAACH,MAAM,CAAC;IAElE,IAAI,CAACE,MAAM,EAAE;MACTZ,GAAG,CAACc,IAAI,CAAC,sBAAsB,CAAC;MAEhC,OAAO,IAAI;IACf;IAEA,IAAIF,MAAM,CAACG,OAAO,KAAKC,SAAS,EAAE;MAC9BhB,GAAG,CAACc,IAAI,CAAC,uBAAuB,CAAC;MAEjC,OAAO,IAAI;IACf;IAEA,IAAIF,MAAM,CAACK,EAAE,KAAKD,SAAS,EAAE;MACzBhB,GAAG,CAACc,IAAI,CAAC,kBAAkB,CAAC;MAE5B,OAAO,IAAI;IACf;IAEA,IAAIF,MAAM,CAACJ,QAAQ,KAAKQ,SAAS,EAAE;MAC/BhB,GAAG,CAACc,IAAI,CAAC,wBAAwB,CAAC;MAElC,OAAO,IAAI;IACf;IAEA,OAAO;MACHC,OAAO,EAAEnB,MAAM,CAACsB,WAAW,CAACN,MAAM,CAACG,OAAO,CAAC;MAC3CE,EAAE,EAAErB,MAAM,CAACsB,WAAW,CAACN,MAAM,CAACK,EAAE,CAAC;MACjCT,QAAQ,EAAEI,MAAM,CAACJ;IACrB,CAAC;EACL;EAEA,MAAMW,OAAOA,CAACZ,aAAqB,EAAEa,MAA0B,EAA8B;IACzF,MAAMV,MAAM,GAAG;MACXP,mBAAmB,EAAE,IAAI,CAACE,GAAG;MAC7BE,aAAa;MACbQ,OAAO,EAAEnB,MAAM,CAACe,aAAa,CAACS,MAAM,CAACL,OAAO,CAAC;MAC7CE,EAAE,EAAErB,MAAM,CAACe,aAAa,CAACS,MAAM,CAACH,EAAE,CAAC;MACnCT,QAAQ,EAAEY,MAAM,CAACZ;IACrB,CAAC;IAED,MAAMI,MAAM,GAAG,MAAMb,YAAY,CAACsB,wBAAwB,CAACX,MAAM,CAAC;IAElE,IAAI,CAACE,MAAM,EAAE;MACTZ,GAAG,CAACc,IAAI,CAAC,sBAAsB,CAAC;MAEhC,OAAO,IAAI;IACf;IAEA,OAAOlB,MAAM,CAACsB,WAAW,CAACN,MAAM,CAACH,IAAI,CAAC;EAC1C;EAGA,MAAMa,OAAOA,CAAA,EAAG;IACZ,MAAMZ,MAAM,GAAG;MACXP,mBAAmB,EAAE,IAAI,CAACE;IAC9B,CAAC;IAED,MAAMN,YAAY,CAACwB,wBAAwB,CAACb,MAAM,CAAC;EACvD;AACJ"}